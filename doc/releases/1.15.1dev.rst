
Version 1.15.1dev
=================

Installation Changes
--------------------

Dependency Changes
------------------

- PypeIt now only supports python versions 3.10 or later, and numpy version 1.23 and later

Functionality/Performance Improvements and Additions
----------------------------------------------------
- Allow the selection of a secondary filter option  for all spectrographs
that need it; see new ``filter2`` parameter.

- When dealing with `bkg_redux` reduction (i.e., A-B), a sky model (called `bkg_redux_skymodel`)
  is generated using the A frame, while the existing `skymodel` is generated using the A-B frame.
  This allows to have an actual 1D extracted sky spectrum and to perform the flexure correction for
  `bkg_redux` reduction.

- Various improvements in the flexure correction and added the possibility to use a modeled archive
  sky spectrum generated with `pypeit.wavemodel.nearIR_modelsky()` to perform the flexure correction.

Instrument-specific Updates
---------------------------
- Improvements for SOAR/Goodman
    - Added ``WAVMODE`` header keyword to ``configuration keys`` and
     ``raw header cards``.

- Added example of improved wavelength solution for GEMINI/GMOS
- Expanded the template for `shane_kast_red` and the 1200/5000 grating

Script Changes
--------------

- A new script, called `pypeit_extract_datacube`, allows 1D spectra of point
  sources to be extracted from datacubes.
- The sensitivity function is now generated outside of datacube generation.
- The `grating_corr` column is now used to select the correct grating
  correction file for each spec2d file when generating the datacube.

Datamodel Changes
-----------------
- `Spec2DObj` now has an additional image, called `bkg_redux_skymodel`, which is the "actual" sky model
  in the case of `bkg_redux` reduction (i.e., dithered observations). This image is not generated if
  `bkg_redux` is False. In any case, the `skymodel` is always generated.

Under-the-hood Improvements
---------------------------

Bug Fixes
---------

- The subpixel algorithm used to resample datacubes that are generated by `pypeit_coadd_datacube`
  produced error cubes that were not properly propagating the noise. The error cubes of the NGP
  algorithm were unaffected. The error cubes are now regularly inspected with vet tests to ensure
  the error cubes are reliable.
- Allow `spec_flex_shift()` to take as input either the name of an archive sky spectrum or
  directly a sky spectrum. This fixes a bug in the flexure correction for SlicerIFU.
- Fix a bug (introduced in a recent PR) that was generating an error if less than 2 spec1d
  files were used with `pypeit_coadd_1dspec`. Now the script can be run with only one
  file (as it was before).
