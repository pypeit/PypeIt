===========
MasterTilts
===========

Overview
========

This file describes the data model for the `MasterTilts`_.


The images are written to disk as a multi-extension FITS file
prefixed by `MasterTilts`_ in the Masters/ folder.
See :ref:`masters:Masters Naming` for the naming convention.


Inspecting
==========

At present, the only way to examine the quality of this
step is by viewing the PNG files generated by the code.
:doc:`qa` describes how to access them.

There are 3 PNG files generated per slit:

2D Arc Tilts
------------

This QA shows the spectral,spatial positions of all
the lines traced by the code.  Here is an example
from `shane_kast_red`:

.. image:: figures/arc_tilts_2d.png

Here is what you hope to see in this QA:

 - RMS < 0.1
 - Very few red points
 - The red points are mainly at the very edges of the black lines
 - The black points span across the full detector

On the last point, if only a smaller portion of the detector
is covered, the code is extrapolating.
Indeed, the example above only shows
outputs down to ~480 Spectral Pixel which is not ideal.
Of course, this will be the case for spectrographs
that have data which does not span the full detector.

Spat Tilts
----------

This QA examines the residuals of (tilt position - model)
as a function of spatial offset along the slit.  Here
is an example from `shane_kast_red`:

.. image:: figures/arc_tilts_spat.png

One hopes to see small residuals and without any substantial
spatial dependence.  But, it is comment for there to be
significant residuals at the edges of the slit
(as in this example).

Spec Tilts
----------

This QA examines the residuals of (tilt position - model)
as a function of spetral offset along the slit.  Here
is an example from `shane_kast_red`:

.. image:: figures/arc_tilts_spec.png

One hopes to see:

 - The black points scattering about 0
 - The orange and green points not too far above 0

Trouble Shooting
================

If one or more of your image appears to be in err,
here are the things to consider:

Insufficient Lines
------------------

TODO: Explain how to add more


Current WaveTilts Data Model
============================

Internally, the image is held in
:class:`pypeit.wavetilts.WaveTilts`
which is a :class:`pypeit.datamodel.DataContainer`.
The datamodel written to disk is:


.. include:: include/datamodel_wavetilts.rst

