.. _master_wvcalib:

===============
MasterWaveCalib
===============

Overview
========

This file describes the data model for the `MasterWaveCalib`_.

The images are written to disk as a multi-extension FITS file
prefixed by `MasterWaveCalib`_ in the Masters/ folder.
See :ref:`masters:Masters Naming` for the naming convention.

Inspecting
==========

.. _pypeit-chk-wavecalib:

pypeit_chk_wavecalib
--------------------

You can print a set of simple diagnostics to the screen
with the *pypeit_chk_wavecalib* script, e.g. ::

     pypeit_chk_wavecalib Masters/MasterWaveCalib_A_1_03.fits
     #
     SpatID minWave Wave_cen maxWave dWave Nlin  RMS
    ------ ------- -------- ------- ----- ---- -----
        54  5596.7   6858.8  8236.6 0.680   12 0.573
       148  3620.1   4946.3  6259.7 0.647   16 0.234
       230  4105.6   5368.2  6673.7 0.629   33 0.164
       302  5615.7   6889.9  8234.8 0.685    6 0.002
       384  3980.9   5242.8  6548.3 0.629   31 0.121
       482  4081.7   5344.4  6649.7 0.629   34 0.186
       586  4154.5   5417.4  6722.6 0.629   32 0.120


PNGs
----

At present, the only way to examine the quality of this
step is by viewing the PNG file generated by the code.
:doc:`qa` describes how to access them.

There is 1 PNG file generated per slit.  Here is an
example from the `shane_kast_red` spectrograph.

.. image:: figures/arc_1d_fit.png

What you hope to see in your QA is:

 - On the left, many of the blue arc lines marked with IDs
 - In the upper right, an RMS < 0.1 pixels
 - In the lower right, a random scatter about 0 residuals


Trouble Shooting
================

Wavelength solutions are amongst the most challenging
part of data reduction.  See :doc:`wave_calib` for
extensive details on how PypeIt performs wavelength
calibration and related issues.


Current WaveCalib Data Model
============================

Internally, the image is held in
:class:`pypeit.wavecalib.WaveCalib`
which is a :class:`pypeit.datamodel.DataContainer`.
The datamodel written to disk is:

.. include:: include/datamodel_wavecalib.rst


