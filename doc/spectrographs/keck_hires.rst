==========
Keck HIRES
==========

Overview
========

This file summarizes several instrument specific settings that are related to the Keck/HIRES spectrograph.
Currently, PypeIt only supports the reduction of the post detector upgrade HIRES data (around August 2004).
Information on the frame typing and instrument configuration can be found in ref:`hiresframes` and :ref:`hiresconfig`.

Default Settings
++++++++++++++++

See :ref:`instr_par-keck_hires` for a list of modifications to the default settings.
*You do not have to add these changes to your PypeIt reduction file!*  This is just a list of
how the parameters used for HIRES differ from the defaults listed in the preceding tables on that page.
Moreover, additional modifications may have been made for specific setups, e.g, for different binning,
etc. You can see a list of all the used parameters in the ``keck_hires_XXX.par``
file generated by PypeIt at the beginning of the reduction.

MOSAIC
======

PypeIt, by default, uses a mosaic approach for the reduction. It basically constructs a mosaic
of the blue, green, and red detector data and reduces it, instead of processing the detector data individually.
The mosaic reduction is switched on by setting the parameter ``detnum`` in :ref:`reduxpar` to be a
tuple of the detector indices that are mosaiced together. For HIRES, it looks like:

.. code-block:: ini

    [rdx]
        spectrograph = keck_hires
        detnum = (1,2,3)

This is already the default for HIRES, but the user can modify it in the :ref:`pypeit_file` to
turn off the mosaic reduction.


Calibrations
============

Flat Fielding
-------------
Special type of "slitless" flat images are sometime used for correcting
pixel-to-pixel variations in the HIRES data. These flats images are taken
with the cross disperser cover on, so that the light is somewhat diffused
and the orders are not visible. If this type of frames are present in the
:ref:`pypeit_file`, during the main reduction PypeIt will be able to identify them,
assign the correct frame type (`slitless_pixflat`), and use them for creating a "slitless"
pixel flat. Since, these frames are taken with different exposure time and
cross-disperser angle for each detector, PypeIt is able to select the correct
observations for each detector. The pixelflat is generated by first scaling
each flat frame to have the same mean counts, then median combining them.
A pixelflat file will be generated and stored in the reduction folder.
The file will also be saved to the PypeIt cache directory
``data/static_calibs/keck_hires`` and will be automatically used during
the reduction process. To use this file in future reductions, the user can add the
pixelflat file name to the :ref:`pypeit_file` as shown below:

.. code-block:: ini

   [calibrations]
      [[flatfield]]
         pixelflat_file = pixelflat_keck_hires_RED_1x2_20160330.fits.gz

See more in :ref:`generate-pixflat`.



Wavelengths
-----------

See :ref:`wvcalib-echelle` for details on the wavelength calibration.


Additional Reading
==================

Here are additional docs related to Keck/HIRES.  Note all of them are related
to the development of PypeIt for use with HIRES data:

.. TODO: Generally useful information in these dev docs should be moved into
.. user-level doc pages, even if that means repeating information.

.. toctree::
   :maxdepth: 1

   ../dev/hiresframes
   ../dev/hiresconfig